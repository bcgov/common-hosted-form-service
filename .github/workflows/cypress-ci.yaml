name: Cypress Report
on:
  push:
    branches:
        - 'master'
jobs:
  cypress-test:
     name: Run on Chrome 106
     runs-on: ubuntu-22.04
     container:cypress/browsers: node-18.15.0-chrome-106.0.5249.61-1-ff-99.0.1
     steps:
      - uses: actions/checkout@v2

  -  name: Cypress install
     run: |
       npm ci
       $(npm bin)/cypress verify

  -  name: Run Cypress tests
     run: npm run test:chrome
      continue-on-error: false

  -  name: Copy test execution videos and screenshots
     run: |
        mkdir artifacts
        cp -r cypress/videos artifacts/videos
        cp -r cypress/screenshots artifacts/screenshots

  -  name: Merge test reports
     run: npm run combine:report

  -  name: Generate HTML report
     run: npm run generate:report

  -  name: Deploy report page to GitHub page
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{secrets.GITHUB_TOKEN}}   
        publish_dir: ./artifacts